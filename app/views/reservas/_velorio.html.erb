<div class="painel col-md-10 col-md-offset-1">
  <div class="titulo">
    <h2>Relatório de reservas</h2>
  </div>
  <div class="conteudo-painel">
    <table border="1" class="table table-striped">
      <thead>
        <tr>
          <th>Velório</th>
          <th>Sala</th>
          <th>Sepultamento</th>
          <th>Atendente</th>
          <th>Falecido</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        <% @velorio.reservas.order(sepultamento: :desc).each do |r| %>
          <tr>
            <td><%= r.velorio.nome %></td>
            <td><%= Velorio.find(r.velorio_id).salas.index(Sala.find(r.sala_id)).to_i + 1 %></td>
            <td><%= r.sepultamento.to_s.chomp(' -0200') %></td>
            <td><%= r.atendente.funcionario.nome %></td>
            <td><%= r.falecido %></td>
            <td>
              <% if r.sepultamento < Time.now %>
                <span type="button" data-toggle="modal" data-target="#exp_<%= r.id %>">
                  <div class="disabledBut">
                    <i class="fa fa-lock"></i>
                  </div>
                </span>
              <% else %>
                <%= link_to edit_reserva_path(r), class: 'myButton' do %>
                  <i class="fa fa-pencil-square-o" style="margin-left: 2px;"></i>
                <% end %>
              <% end %>
              <span type="button" data-toggle="modal" data-target="#myModal<%= r.id %>">
                <div class="dangerBut">
                  <i class="fa fa-times"></i>
                </div>
              </span>
            </td>  
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
  <div class="painel-footer">
  </div>
</div>

<% @velorio.reservas.each do |r| %>
  <div class="modal fade" id="myModal<%= r.id %>" role="dialog">
    <div class="modal-dialog">
      <div class="cimodal tam6 col-md-offset-1">
        <div class="titulo">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title">Atenção</h4>
        </div>
        <div class="conteudo-modal">
          <p>Tem certeza que deseja deletar esta reserva?</p>
        </div>
        <div class="modal-footer">
          <%= link_to "Deletar", r, method: :delete, class: "dangerBut" %>
          <button type="button" class="myButton" data-dismiss="modal">Manter</button>
        </div>
      </div>
    </div>
  </div>
  <div class="modal fade" id="exp_<%= r.id %>" role="dialog">
    <div class="modal-dialog">
      <div class="cimodal tam6 col-md-offset-1">
        <div class="titulo">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title">Atenção</h4>
        </div>
        <div class="conteudo-modal">
          <p>Essa reserva já expirou.</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="myButton" data-dismiss="modal">Fechar</button>
        </div>
      </div>
    </div>
  </div>
<% end %>